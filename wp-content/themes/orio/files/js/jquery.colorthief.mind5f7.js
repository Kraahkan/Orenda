/*
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 * License
 * -------
 * Copyright 2011, 2015 Lokesh Dhakar
 * Released under the MIT license
 * https://raw.githubusercontent.com/lokesh/color-thief/master/LICENSE
 *
 * @license
 */

var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r){return this.getPalette(t,5,r)[0]},ColorThief.prototype.getPalette=function(t,r,n){(void 0===r||r<2||r>256)&&(r=10),(void 0===n||n<1)&&(n=10);for(var e,o,a,i,u=new CanvasImage(t),c=u.getImageData().data,s=u.getPixelCount(),f=[],h=0;h<s;h+=n)o=c[(e=4*h)+0],a=c[e+1],i=c[e+2],c[e+3]>=125&&(o>250&&a>250&&i>250||f.push([o,a,i]));var v=MMCQ.quantize(f,r),p=v?v.palette():null;return u.removeCanvas(),p},ColorThief.prototype.getColorFromUrl=function(t,r,n){sourceImage=document.createElement("img");var e=this;sourceImage.addEventListener("load",function(){var o=e.getPalette(sourceImage,5,n)[0];r(o,t)}),sourceImage.src=t},ColorThief.prototype.getImageData=function(t,r){xhr=new XMLHttpRequest,xhr.open("GET.html",t,!0),xhr.responseType="arraybuffer",xhr.onload=function(t){if(200==this.status){uInt8Array=new Uint8Array(this.response),n=uInt8Array.length,binaryString=new Array(n);for(var n=0;n<uInt8Array.length;n++)binaryString[n]=String.fromCharCode(uInt8Array[n]);data=binaryString.join(""),base64=window.btoa(data),r("data:image/png;base64,"+base64)}},xhr.send()},ColorThief.prototype.getColorAsync=function(t,r,n){var e=this;this.getImageData(t,function(t){sourceImage=document.createElement("img"),sourceImage.addEventListener("load",function(){var t=e.getPalette(sourceImage,5,n)[0];r(t,this)}),sourceImage.src=t})},!pv)var pv={map:function(t,r){var n={};return r?t.map(function(t,e){return n.index=e,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,e,o){return n.index=o,t+r.call(n,e)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){var t=5,r=8-t,n=1e3,e=.75;function o(r,n,e){return(r<<2*t)+(n<<t)+e}function a(t){var r=[],n=!1;function e(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||e(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||e(),r}}}function i(t,r,n,e,o,a,i){var u=this;u.r1=t,u.r2=r,u.g1=n,u.g2=e,u.b1=o,u.b2=a,u.histo=i}function u(){this.vboxes=new a(function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function c(t,r){if(r.count()){var n=r.r2-r.r1+1,e=r.g2-r.g1+1,a=r.b2-r.b1+1,i=pv.max([n,e,a]);if(1==r.count())return[r.copy()];var u,c,s,f,h=0,v=[],p=[];if(i==n)for(u=r.r1;u<=r.r2;u++){for(f=0,c=r.g1;c<=r.g2;c++)for(s=r.b1;s<=r.b2;s++)f+=t[o(u,c,s)]||0;h+=f,v[u]=h}else if(i==e)for(u=r.g1;u<=r.g2;u++){for(f=0,c=r.r1;c<=r.r2;c++)for(s=r.b1;s<=r.b2;s++)f+=t[o(c,u,s)]||0;h+=f,v[u]=h}else for(u=r.b1;u<=r.b2;u++){for(f=0,c=r.r1;c<=r.r2;c++)for(s=r.g1;s<=r.g2;s++)f+=t[o(c,s,u)]||0;h+=f,v[u]=h}return v.forEach(function(t,r){p[r]=h-t}),g(i==n?"r":i==e?"g":"b")}function g(t){var n,e,o,a,i,c=t+"1",s=t+"2",f=0;for(u=r[c];u<=r[s];u++)if(v[u]>h/2){for(o=r.copy(),a=r.copy(),i=(n=u-r[c])<=(e=r[s]-u)?Math.min(r[s]-1,~~(u+e/2)):Math.max(r[c],~~(u-1-n/2));!v[i];)i++;for(f=p[i];!f&&v[i-1];)f=p[--i];return o[s]=i,a[c]=o[s]+1,[o,a]}}}return i.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(t){var r=this,n=r.histo;if(!r._count_set||t){var e,a,i,u=0;for(e=r.r1;e<=r.r2;e++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)u+=n[o(e,a,i)]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var t=this;return new i(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var n=this,e=n.histo;if(!n._avg||r){var a,i,u,c,s=0,f=1<<8-t,h=0,v=0,p=0;for(i=n.r1;i<=n.r2;i++)for(u=n.g1;u<=n.g2;u++)for(c=n.b1;c<=n.b2;c++)s+=a=e[o(i,u,c)]||0,h+=a*(i+.5)*f,v+=a*(u+.5)*f,p+=a*(c+.5)*f;n._avg=s?[~~(h/s),~~(v/s),~~(p/s)]:[~~(f*(n.r1+n.r2+1)/2),~~(f*(n.g1+n.g2+1)/2),~~(f*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(t){var n=this,e=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,e>=n.r1&&e<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,e,o=this.vboxes,a=0;a<o.size();a++)((n=Math.sqrt(Math.pow(t[0]-o.peek(a).color[0],2)+Math.pow(t[1]-o.peek(a).color[1],2)+Math.pow(t[2]-o.peek(a).color[2],2)))<r||void 0===r)&&(r=n,e=o.peek(a).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,e=t[n].color;e[0]>251&&e[1]>251&&e[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(s,f){if(!s.length||f<2||f>256)return!1;var h,v,p,g,l,m,b=(h=s,m=new Array(1<<3*t),h.forEach(function(t){p=t[0]>>r,g=t[1]>>r,l=t[2]>>r,v=o(p,g,l),m[v]=(m[v]||0)+1}),m);b.forEach(function(){});var d,x,y,C,I,w,M,_,z,E,A=(d=b,I=1e6,w=0,M=1e6,_=0,z=1e6,E=0,s.forEach(function(t){x=t[0]>>r,y=t[1]>>r,C=t[2]>>r,x<I?I=x:x>w&&(w=x),y<M?M=y:y>_&&(_=y),C<z?z=C:C>E&&(E=C)}),new i(I,w,M,_,z,E,d)),T=new a(function(t,r){return pv.naturalOrder(t.count(),r.count())});function k(t,r){for(var e,o=1,a=0;a<n;)if((e=t.pop()).count()){var i=c(b,e),u=i[0],s=i[1];if(!u)return;if(t.push(u),s&&(t.push(s),o++),o>=r)return;if(a++>n)return}else t.push(e),a++}T.push(A),k(T,e*f);for(var D=new a(function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});T.size();)D.push(T.pop());k(D,f-D.size());for(var P=new u;D.size();)P.push(D.pop());return P}}}();
